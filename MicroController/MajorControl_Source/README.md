# 01 项目介绍

本项目是基于STM32F1系列的智能小车的操控与驱动代码，使用HAL库编写，IDE为CLion。可以实现平地小球收集，框内小球收集，上10±2cm高台等功能

# 02 使用芯片

* STM32F103C8T6 2片
* STM32F103ZET6 1片

# 03 目录结构

```
.
├── README.md
├── Regular.txt                     # 遥控器指令表/OLED菜单说明
├── PCB                             # 两张 PCB 源文件(嘉立创 EDA `.eprj`)
│   ├── MotherBoard.eprj              # 主控 PCB (还与另一张供电 PCB 相连)
│   └── RemoteController.eprj         # 遥控器 PCB
├── DriveControl                    # 电机、舵机驱动板(C8T6)源代码
├── RemoteController                # 遥控器源代码
└── RobotMatchZET6                  # 主控板源代码
```

# 04 功能说明

## 4.1 遥控器

1. 多级菜单，可以直接通过 **右摇杆** 与 **PCB上的按钮** 来操控、选择菜单，并且通过 `NRF24L01` 模块与主控板上的 `ZET6` 进行通信传输，同时会通过 **反色来显示当前所在行** 
2. 通过不同指令来指挥小车(指令表可以查看 [Regular](./Regular.md))，让小车处于不同状态
3. 在 `DMA` 模式下读取 `ADC` 数据，实现对摇杆状态的识别，并实现 **多级速度调节** 
4. PCB拥有 **充电、电源管理、降压升压** 功能

## 4.2 `ZET6` 主控板

1. 通过`NRF24L01` 来与遥控器通信，读取指令并使小车处于不同状态(上高台模式、滚筒实时控制模式、铲子控制模式、图像识别模式)
2. 通过 `TIM` 的编码器模式来 **读取电机编码器数据** ，实现 **电机测速与 `PID` 控制** 
3. 通过 `USART` 与小车驱动板(及另一块 `stm32f103c8t6` )通信，让小车驱动板输出不同的`PWM`，从而实现舵机的控制

## 4.3 C8T6小车驱动板

1. 通过 `USART` 与 `ZET6` 通信， **向 `ZET6` 发起数据申请** ，并等待数据回复，避免丢包或者数据串位的情况，让通信更加安全稳定
2. 对 `ZET6` 发过来的数据进行 **解析并进行相应操作** ，分为菜单状态操作与电机PWM操作
3. 在 `Detect` 模式下，解析电脑通过 `USB2TTL` 发送过来的数据，并对装有激光的舵机进行控制

# 05 使用说明

1. 通过嘉立创EDA软件打板得到遥控器与主控板，并对器件进行连接
2. 打开遥控器上的红色开关拨片，此时单片机上方两个LED应当全为红色，左边LED为通信 `Debug LED` ，当通信能被主控板正常接收时，为熄灭状态，右边为可编程LED
3. 让主控板接通电源，此时 `NRF24L01` 上电，并被初始化，正常情况下遥控器的通信 `Debug LED` 在此时熄灭
4. 推动遥控器 **左摇杆** ，可控制小车前进后退，向左向右平移，并且根据推动程度，改变小车的目标速度，通过 `PID` 使得小车有不同速度
5. 于 **0级菜单或者非控制状态** 下， **上下** 推动 **右摇杆** ，为 **选择菜单** ，0级菜单有四个模块，根据英文提示可以得知相应功能
6. 于 ** 0级菜单或者非控制状态** 下， **左右** 推动右摇杆，为控制小车 **顺逆时针原地旋转** 
7. 在 **滚筒实时控制模式** 状态下，右摇杆上下控制菜单的功能被 **锁定** ，改为 **滚筒的升起和下降** ，左右控制仍为顺逆时针旋转
8. 在 **上高台模式** 下，右摇杆被锁定， **上下控制滚筒升降** ，**左右控制小车后两根支撑柱升降** 
9. 在 **`Boost` 模式** 下，驱动板会 **忽略 `PID`** ，强制输出较高PWM，让小车具有较强的启动力
10. 在 **`Detect` 模式** 下，`ZET6` 的 **`USART` 会失能** ，同时 **小车驱动板(C8T6)的 `USART` 与电脑连接**，接受并解析电脑发送的两个舵机 `PWM` 控制数据， **直到 `Detect` 模式的退出** ， `ZET6` 的 `USART` 重新使能，并向驱动板发送一个 `\t` 来激活驱动板发送请求的行为
11. 在 **铲子控制模式** 下，**右摇杆被锁定** ，上下控制铲子旋转角度，左右控制齿条伸出收入行为
12. **在任何模式下强制退出1级菜单都会使小车清空状态，滚筒，传送带，支撑住，铲子都会回到初始位置**
